<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<style>
      #map {
        height: 100%;
	width: 80%;      
      }
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #floating-panel {
        position: absolute;
        top: 10px;
        left: 25%;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        font-family: 'Roboto','sans-serif';
        line-height: 30px;
        padding-left: 10px;
      }
    </style>

</head>
<body class="main">
<h1>Привет, мир!</h1>

<div id="map"></div>

<script type="text/javascript">
	var HttpClient = function() {
    this.get = function(aUrl, aCallback) {
        var anHttpRequest = new XMLHttpRequest();
        anHttpRequest.onreadystatechange = function() { 
            if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
                aCallback(anHttpRequest.responseText);
        }

        anHttpRequest.open( "GET", aUrl, true );            
        anHttpRequest.send( null );
    }
}

var client = new HttpClient();

var map;

function initMap() {
  var myLatLng = {lat:59.6922455, lng: 75.1798578};

   map = new google.maps.Map(document.getElementById('map'), {
    zoom: 8.74,
    center: myLatLng
  });
   client.get('/sensor', function(response) {
   JSON.parse(response).sensors.forEach(addMarker);
   
   });
}

function addMarker(sensor) {
  let url = "http://maps.google.com/mapfiles/ms/icons/blue-dot.png";
  switch (sensor.status) {
  	case 0: url = "http://maps.google.com/mapfiles/ms/icons/red-dot.png"; break;
    case 1: url = "http://maps.google.com/mapfiles/ms/icons/green-dot.png"; break;
  }

  let marker = new google.maps.Marker({
    map: map,
    position: sensor.position,
    label: sensor.label,    
icon: {
      url: url
    }
  });
}

</script>
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=GOOGLE_API_KEY&callback=initMap">
    </script>
 
</body>
</html>
